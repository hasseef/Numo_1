<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>نمو NOMU — لوحة المراكز الوطنية</title>
<style>
  :root{ --bg:#0b1220;--card:#111a2b;--muted:#17223a;--pri:#5ac8fa;--sec:#8ef6d0;--acc:#ffd166;--ok:#22c55e;--danger:#ff6b6b;--text:#e6edf7;--sub:#a7b0c3;--border:#263251;--radius:18px;--pad:18px;--gap:14px;--shadow:0 10px 30px rgba(0,0,0,.35);--font:system-ui,"Segoe UI",Tahoma,Arial }
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1220,#0e172a);color:var(--text);font:15px/1.6 var(--font)}
  a{color:var(--pri)} .btn{background:var(--pri);color:#06121c;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(90,200,250,.25)}
  .ghost{background:transparent;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 14px;cursor:pointer}
  header{position:sticky;top:0;z-index:20;background:rgba(11,18,32,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
  .topbar{max-width:1240px;margin:auto;padding:10px var(--pad);display:flex;align-items:center;gap:10px}
  .logo{display:flex;gap:10px;align-items:center;font-weight:900}.logo .ph{width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,var(--pri),var(--sec))}
  .main{max-width:1240px;margin:22px auto;display:grid;grid-template-columns:280px 1fr;gap:22px;padding:0 var(--pad)}
  nav .side{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:12px;position:sticky;top:66px}
  .section{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:var(--pad);box-shadow:var(--shadow)}
  .group{display:grid;gap:10px} .field label{display:block;color:var(--sub);font-size:12px;margin-bottom:6px}
  .field input,.field select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#0f172a;color:var(--text)}
  .toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .tag{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:var(--muted);padding:6px 10px;border-radius:999px;color:var(--sub);font-size:12px}
  .grid{display:grid;gap:var(--gap)} .grid.two{grid-template-columns:1fr 1fr} .grid.three{grid-template-columns:repeat(3,1fr)} .grid.four{grid-template-columns:repeat(4,1fr)}
  .kpi{background:linear-gradient(180deg,#0f1a31,#0f1829);border:1px solid var(--border);border-radius:14px;padding:14px}
  .kpi b{display:block;font-size:24px;margin-top:6px}
  .heat{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .cell{border:1px solid var(--border);border-radius:12px;padding:10px;background:#0f172a;min-height:70px}
  .cell h4{margin:0;font-size:13px;color:#c7d2e0}
  .bar{height:8px;border-radius:8px;background:#0e1630;margin-top:8px;overflow:hidden}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--pri),var(--sec));width:0}
  .list{display:grid;gap:10px}
  .card{border:1px solid var(--border);border-radius:14px;padding:12px;background:#0f172a}
  .card .title{display:flex;justify-content:space-between;gap:10px}
  .status{font-size:12px;border-radius:999px;padding:4px 8px;border:1px solid var(--border);background:#12203a;color:#a7b0c3}
  .ok{background:rgba(34,197,94,.15)!important;color:#9be7b4}
  .warn{background:rgba(255,209,102,.15)!important;color:#ffe8a6}
  .danger{background:rgba(255,107,107,.15)!important;color:#ffb3b3}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .empty{border:1px dashed var(--border);padding:20px;border-radius:12px;color:#9aa7c1}
  footer{max-width:1240px;margin:18px auto;color:#9aa7c1;text-align:center;padding:0 var(--pad)}
  @media (max-width:980px){ .main{grid-template-columns:1fr} .grid.four{grid-template-columns:1fr 1fr} .heat{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>
<header>
  <div class="topbar">
    <div class="logo"><div class="ph"></div><span>نمو NOMU</span></div>
    <div style="margin-inline-start:auto" class="badges">
      <span class="tag">لوحة المراكز الوطنية</span>
      <span class="tag" id="tagRegion">المنطقة: الكل</span>
      <span class="tag" id="tagSector">القطاع: الكل</span>
    </div>
  </div>
</header>

<main class="main">
  <nav>
    <div class="side">
      <h3 style="margin-top:0">مرشّحات</h3>
      <div class="group">
        <div class="field">
          <label>المنطقة</label>
          <select id="fRegion">
            <option value="">الكل</option>
            <option>الرياض</option><option>حائل</option><option>الشرقية</option>
          </select>
        </div>
        <div class="field">
          <label>القطاع</label>
          <select id="fSector">
            <option value="">الكل</option>
            <option value="health">الصحة</option>
            <option value="education">التعليم</option>
            <option value="social">الاجتماعي/الدعم</option>
            <option value="nonprofit">الجمعيات</option>
            <option value="psych">النفسية/السلوكية</option>
            <option value="training">التدريب والتأهيل</option>
            <option value="volunteer">التطوع</option>
          </select>
        </div>
        <div class="field">
          <label>الجهة المشرفة (نص)</label>
          <input id="fSuper" placeholder="اكتب جزءًا من الاسم">
        </div>
        <div class="actions">
          <button class="btn" id="btnApply">تطبيق</button>
          <button class="ghost" id="btnReset">إعادة ضبط</button>
        </div>
      </div>

      <hr style="border-color:var(--border);margin:14px 0">

      <h3>إضافة مركز (محلي)</h3>
      <div class="group">
        <div class="field"><label>الاسم</label><input id="nName"></div>
        <div class="field"><label>المنطقة</label><select id="nRegion"><option>الرياض</option><option>حائل</option><option>الشرقية</option></select></div>
        <div class="field"><label>القطاع</label>
          <select id="nSector">
            <option value="health">الصحة</option><option value="education">التعليم</option><option value="social">الاجتماعي/الدعم</option><option value="nonprofit">الجمعيات</option><option value="psych">النفسية/السلوكية</option><option value="training">التدريب</option><option value="volunteer">التطوع</option>
          </select>
        </div>
        <div class="field"><label>الجهة المشرفة</label><input id="nSuper" placeholder="وزارة/إدارة/جمعية..."></div>
        <div class="field"><label>الحالة</label><select id="nStatus"><option>فعّال</option><option>قيد الربط</option><option>متوقف مؤقتًا</option></select></div>
        <button class="ghost" id="btnAdd">إضافة للمجموعة</button>
      </div>

      <hr style="border-color:var(--border);margin:14px 0">

      <button class="ghost" id="btnCSV">تصدير المراكز (CSV)</button>
    </div>
  </nav>

  <section class="section">
    <div class="toolbar">
      <h2 style="margin:0">نظرة عامة</h2>
      <div class="actions">
        <span class="tag">تغطية وطنية</span>
      </div>
    </div>
    <div class="grid four" id="kpis">
      <div class="kpi"><span>عدد المراكز</span><b id="kCenters">—</b></div>
      <div class="kpi"><span>مراكز فعّالة</span><b id="kActive">—</b></div>
      <div class="kpi"><span>مراكز قيد الربط</span><b id="kPending">—</b></div>
      <div class="kpi"><span>معدل التغطية*</span><b id="kCoverage">—</b><div style="font-size:12px;color:#8ca1c3;margin-top:6px">* تقريبي حسب الحجم النسبي لكل منطقة/قطاع</div></div>
    </div>

    <h3 style="margin-top:16px">خريطة تغطية (شبكة مبسطة)</h3>
    <div class="heat" id="heat"></div>

    <h3 style="margin-top:16px">المراكز المطابقة</h3>
    <div id="list" class="list"></div>
  </section>
</main>

<footer>
  NOMU — لوحة المراكز الوطنية (نسخة عرض). البيانات محلية لأغراض المعاينة.
</footer>

<script>
const $=(q,root=document)=>root.querySelector(q); const $$=(q,root=document)=>Array.from(root.querySelectorAll(q));
const fmt=n=>new Intl.NumberFormat('ar-SA').format(n);

const sectors = {
  health:'الصحة', education:'التعليم', social:'الاجتماعي/الدعم', nonprofit:'الجمعيات',
  psych:'النفسية/السلوكية', training:'التدريب والتأهيل', volunteer:'التطوع'
};

let centers = [
  {id:'H-RIY-001', name:'مستشفى الملك سلمان', region:'الرياض', sector:'health', supervisor:'وزارة الصحة', status:'فعّال'},
  {id:'P-RIY-002', name:'عيادة نمو الطفل — الندى', region:'الرياض', sector:'psych', supervisor:'وزارة الصحة', status:'فعّال'},
  {id:'E-RIY-003', name:'روضة الياسمين', region:'الرياض', sector:'education', supervisor:'وزارة التعليم', status:'فعّال'},
  {id:'N-RIY-004', name:'جمعية رعاية الطفولة — الرياض', region:'الرياض', sector:'nonprofit', supervisor:'مركز القطاع غير الربحي', status:'قيد الربط'},
  {id:'S-RIY-005', name:'مركز تمكين الأسرة — غرب الرياض', region:'الرياض', sector:'social', supervisor:'وزارة الموارد البشرية', status:'فعّال'},
  {id:'T-RIY-006', name:'معهد تدريب تربوي — شمال الرياض', region:'الرياض', sector:'training', supervisor:'TVTC', status:'فعّال'},
  {id:'V-RIY-007', name:'وحدة التطوع — جامعة الملك سعود', region:'الرياض', sector:'volunteer', supervisor:'منصة العمل التطوعي', status:'فعّال'},

  {id:'H-HAI-101', name:'مركز صحي شمال حائل', region:'حائل', sector:'health', supervisor:'صحة حائل', status:'فعّال'},
  {id:'P-HAI-102', name:'مركز إرشاد أسري — حائل', region:'حائل', sector:'psych', supervisor:'جمعية نماء', status:'فعّال'},
  {id:'E-HAI-103', name:'روضة الريّان — حائل', region:'حائل', sector:'education', supervisor:'إدارة تعليم حائل', status:'قيد الربط'},
  {id:'N-HAI-104', name:'جمعية نماء للطفولة — حائل', region:'حائل', sector:'nonprofit', supervisor:'مركز القطاع غير الربحي', status:'فعّال'},
  {id:'S-HAI-105', name:'مكتب الضمان — حائل', region:'حائل', sector:'social', supervisor:'وزارة الموارد البشرية', status:'فعّال'},
  {id:'T-HAI-106', name:'مركز تدريب التربية الخاصة — حائل', region:'حائل', sector:'training', supervisor:'TVTC', status:'فعّال'},
  {id:'V-HAI-107', name:'وحدة التطوع — مستشفى حائل', region:'حائل', sector:'volunteer', supervisor:'منصة العمل التطوعي', status:'قيد الربط'},

  {id:'H-EST-201', name:'مستشفى الملك فهد الجامعي', region:'الشرقية', sector:'health', supervisor:'صحة الشرقية', status:'فعّال'},
  {id:'P-EST-202', name:'مركز تعديل السلوك — الدمام', region:'الشرقية', sector:'psych', supervisor:'جمعية أهلية', status:'قيد الربط'},
  {id:'E-EST-203', name:'إدارة تعليم الشرقية — مركز جاهزية', region:'الشرقية', sector:'education', supervisor:'وزارة التعليم', status:'فعّال'},
  {id:'N-EST-204', name:'جمعية همّة — الشرقية', region:'الشرقية', sector:'nonprofit', supervisor:'مركز القطاع غير الربحي', status:'فعّال'},
  {id:'S-EST-205', name:'مركز تنمية — الظهران', region:'الشرقية', sector:'social', supervisor:'وزارة الموارد البشرية', status:'فعّال'},
  {id:'T-EST-206', name:'معهد تدريب الوالدية — الشرقية', region:'الشرقية', sector:'training', supervisor:'TVTC', status:'فعّال'},
  {id:'V-EST-207', name:'وحدة التطوع — جامعة الإمام عبدالرحمن', region:'الشرقية', sector:'volunteer', supervisor:'منصة العمل التطوعي', status:'فعّال'},
];

const baseline = { 'الرياض': 40, 'حائل': 16, 'الشرقية': 24 };

function computeKPIs(data){
  const total = data.length;
  const active = data.filter(c=>c.status==='فعّال').length;
  const pending = data.filter(c=>c.status==='قيد الربط').length;
  const byRegion = data.reduce((acc,c)=>((acc[c.region]=(acc[c.region]||0)+1),acc),{});
  let cov=0, regions=0;
  for(const r of Object.keys(byRegion)){ cov += Math.min(1, byRegion[r]/(baseline[r]||20)); regions++; }
  const coverage = regions? Math.round((cov/regions)*100):0;
  return {total,active,pending,coverage};
}

function renderKPIs(){
  const f = applyFilters(); const k = computeKPIs(f.data);
  $('#kCenters').textContent = fmt(k.total);
  $('#kActive').textContent = fmt(k.active);
  $('#kPending').textContent = fmt(k.pending);
  $('#kCoverage').textContent = k.coverage + '%';
}

function renderHeat(){
  const container = $('#heat'); container.innerHTML='';
  const regions = ['الرياض','حائل','الشرقية'];
  const sectKeys = Object.keys(sectors);
  for(const r of regions){
    for(const s of sectKeys){
      const subset = applyFilters({region:r,sector:s}).data;
      const pct = Math.min(100, Math.round((subset.length / Math.max(1,(baseline[r]/sectKeys.length))) * 100));
      const cell = document.createElement('div'); cell.className='cell';
      cell.innerHTML = `<h4>${r} • ${sectors[s]}</h4><div class="bar"><i style="width:${pct}%"></i></div><div style="font-size:12px;color:#8ca1c3;margin-top:6px">${subset.length} مركز</div>`;
      container.appendChild(cell);
    }
  }
}

function cardStatusClass(status){
  if(status==='فعّال') return 'status ok';
  if(status==='قيد الربط') return 'status warn';
  return 'status danger';
}

function renderList(){
  const list = $('#list'); const f = applyFilters();
  list.innerHTML = '';
  if(!f.data.length){ list.innerHTML = `<div class="empty">لا توجد مراكز مطابقة للمرشّحات الحالية.</div>`; return; }
  for(const c of f.data){
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `
      <div class="title">
        <div><b>${c.name}</b><div style="color:#8ca1c3;font-size:12px">${c.region} • ${sectors[c.sector]} • ${c.supervisor}</div></div>
        <span class="${cardStatusClass(c.status)}">${c.status}</span>
      </div>
      <div class="badges" style="margin-top:8px">
        <span class="tag">ID: ${c.id}</span>
        <span class="tag">زيارات شهرية: ${Math.floor(40+Math.random()*120)}</span>
        <span class="tag">إحالات نشطة: ${Math.floor(Math.random()*10)}</span>
      </div>
      <div class="actions" style="margin-top:8px">
        <button class="ghost" onclick="alert('تفاصيل المركز — للعرض فقط')">تفاصيل</button>
        <button class="ghost" onclick="alert('فتح جدول المواعيد — للعرض فقط')">المواعيد</button>
        <button class="ghost" onclick="alert('تقارير الأداء — للعرض فقط')">تقارير</button>
      </div>
    `;
    list.appendChild(el);
  }
  $('#tagRegion').textContent = 'المنطقة: ' + (f.filters.region || 'الكل');
  $('#tagSector').textContent = 'القطاع: ' + (f.filters.sector ? sectors[f.filters.sector] : 'الكل');
}

function applyFilters(overrides={}){
  const region = overrides.region ?? $('#fRegion').value;
  const sector = overrides.sector ?? $('#fSector').value;
  const superText = ($('#fSuper').value||'').trim().toLowerCase();
  let data = centers.slice();
  if(region) data = data.filter(c=>c.region===region);
  if(sector) data = data.filter(c=>c.sector===sector);
  if(superText) data = data.filter(c=> (c.supervisor||'').toLowerCase().includes(superText));
  return {data, filters:{region,sector,superText}};
}

function exportCSV(){
  const f = applyFilters().data;
  const rows = [['id','name','region','sector','sector_ar','supervisor','status']].concat(
    f.map(c=>[c.id,c.name,c.region,c.sector,sectors[c.sector],c.supervisor,c.status])
  );
  const csv = rows.map(r=>r.map(x=> `"${String(x).replace(/"/g,'""')}"`).join(',')).join('\\n');
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv;charset=utf-8;'}));
  a.download='centers_export.csv'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),500);
}

function addCenter(){
  const id = (Math.random().toString(36).slice(2,8).toUpperCase());
  const c = {
    id: `${$('#nSector').value.toUpperCase().slice(0,1)}-NEW-${id}`,
    name: $('#nName').value || 'مركز جديد',
    region: $('#nRegion').value,
    sector: $('#nSector').value,
    supervisor: $('#nSuper').value || '',
    status: $('#nStatus').value
  };
  centers.unshift(c);
  renderAll();
}

function resetFilters(){
  $('#fRegion').value=''; $('#fSector').value=''; $('#fSuper').value=''; renderAll();
}

function renderAll(){ renderKPIs(); renderHeat(); renderList(); }

$('#btnApply').addEventListener('click', renderAll);
$('#btnReset').addEventListener('click', resetFilters);
$('#btnCSV').addEventListener('click', exportCSV);
$('#btnAdd').addEventListener('click', addCenter);

renderAll();
</script>
</body>
</html>
